



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation to help you get familiar with Pravega">
      
      
        <link rel="canonical" href="https://pravega.io/watermarking/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Watermarking - Exploring Pravega</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#watermarking" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://pravega.io/" title="Exploring Pravega" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Exploring Pravega
              </span>
              <span class="md-header-nav__topic">
                Watermarking
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/pravega/pravega/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://pravega.io/" title="Exploring Pravega" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Exploring Pravega
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/pravega/pravega/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Understanding Pravega
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Understanding Pravega
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../pravega-concepts/" title="Pravega Concepts" class="md-nav__link">
      Pravega Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../terminology/" title="Terminology" class="md-nav__link">
      Terminology
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../key-features/" title="Key Features" class="md-nav__link">
      Key Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../faq/" title="Pravega FAQ" class="md-nav__link">
      Pravega FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../segment-store-service/" title="Segment Store Service" class="md-nav__link">
      Segment Store Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../segment-containers/" title="Segment Containers" class="md-nav__link">
      Segment Containers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../controller-service/" title="Controller Service" class="md-nav__link">
      Controller Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wire-protocol/" title="Wire Protocol" class="md-nav__link">
      Wire Protocol
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../state-synchronizer-design/" title="StateSynchronizer" class="md-nav__link">
      StateSynchronizer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reader-group-design/" title="Reader Groups" class="md-nav__link">
      Reader Groups
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Watermarking
      </label>
    
    <a href="./" title="Watermarking" class="md-nav__link md-nav__link--active">
      Watermarking
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concepts-related-to-watermarking" title="Concepts related to watermarking" class="md-nav__link">
    Concepts related to watermarking
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-watermark" title="The watermark" class="md-nav__link">
    The watermark
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-window" title="Time window" class="md-nav__link">
    Time window
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time" title="Time" class="md-nav__link">
    Time
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-pravega-writers-report-time" title="How Pravega Writers report time" class="md-nav__link">
    How Pravega Writers report time
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explicitly-note-time" title="Explicitly note time" class="md-nav__link">
    Explicitly note time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note-time-on-transaction-commit" title="Note time on transaction commit" class="md-nav__link">
    Note time on transaction commit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatically-attach-wall-clock-time" title="Automatically attach wall clock time" class="md-nav__link">
    Automatically attach wall clock time
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-pravega-readers-request-watermark-windows" title="How Pravega Readers request watermark windows" class="md-nav__link">
    How Pravega Readers request watermark windows
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preventing-a-stalled-watermark" title="Preventing a stalled watermark" class="md-nav__link">
    Preventing a stalled watermark
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-applications" title="Integration with applications" class="md-nav__link">
    Integration with applications
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Developing Pravega Applications
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Developing Pravega Applications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../javadoc/" title="Java API Reference" class="md-nav__link">
      Java API Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rest/restapis/" title="REST API - Controller" class="md-nav__link">
      REST API - Controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../connectors/" title="Pravega Connectors" class="md-nav__link">
      Pravega Connectors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basic-reader-and-writer/" title="Working with Reader and Writer" class="md-nav__link">
      Working with Reader and Writer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reader-group-notifications/" title="Working with Reader Group notifications" class="md-nav__link">
      Working with Reader Group notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../state-synchronizer/" title="Working with State Synchronizer" class="md-nav__link">
      Working with State Synchronizer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../transactions/" title="Working with Transactions" class="md-nav__link">
      Working with Transactions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../streamcuts/" title="Working with StreamCuts" class="md-nav__link">
      Working with StreamCuts
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Running Pravega
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Running Pravega
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment/deployment/" title="Deployment Overview" class="md-nav__link">
      Deployment Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment/run-local/" title="Running Locally" class="md-nav__link">
      Running Locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment/manual-install/" title="Manual Install" class="md-nav__link">
      Manual Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment/kubernetes-install/" title="Deployment on Kubernetes" class="md-nav__link">
      Deployment on Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment/docker-swarm/" title="Deployment on Docker Swarm" class="md-nav__link">
      Deployment on Docker Swarm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment/dcos-install/" title="Deployment on DC/OS" class="md-nav__link">
      Deployment on DC/OS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment/aws-install/" title="Running in the Cloud (AWS)" class="md-nav__link">
      Running in the Cloud (AWS)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../metrics/" title="Pravega Metrics" class="md-nav__link">
      Pravega Metrics
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Pravega Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Pravega Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../auth/auth-plugin/" title="Pravega Authentication/Authorization Plugin" class="md-nav__link">
      Pravega Authentication/Authorization Plugin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../auth/client-auth/" title="Client Auth Interface" class="md-nav__link">
      Client Auth Interface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../security/pravega-security-authorization-authentication/" title="Pravega Security Authorization/Authentication" class="md-nav__link">
      Pravega Security Authorization/Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../security/pravega-security-configurations/" title="Pravega Security Configurations" class="md-nav__link">
      Pravega Security Configurations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../security/pravega-security-encryption/" title="Pravega Security Encryption" class="md-nav__link">
      Pravega Security Encryption
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../security/securing-distributed-mode-cluster/" title="Securing Pravega in Distributed Mode" class="md-nav__link">
      Securing Pravega in Distributed Mode
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Contributing to Pravega
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Contributing to Pravega
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../contributing/" title="Coding guildelines" class="md-nav__link">
      Coding guildelines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../roadmap/" title="Pravega Roadmap" class="md-nav__link">
      Pravega Roadmap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../join-community/" title="Join the Community" class="md-nav__link">
      Join the Community
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concepts-related-to-watermarking" title="Concepts related to watermarking" class="md-nav__link">
    Concepts related to watermarking
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-watermark" title="The watermark" class="md-nav__link">
    The watermark
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-window" title="Time window" class="md-nav__link">
    Time window
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time" title="Time" class="md-nav__link">
    Time
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-pravega-writers-report-time" title="How Pravega Writers report time" class="md-nav__link">
    How Pravega Writers report time
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explicitly-note-time" title="Explicitly note time" class="md-nav__link">
    Explicitly note time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#note-time-on-transaction-commit" title="Note time on transaction commit" class="md-nav__link">
    Note time on transaction commit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatically-attach-wall-clock-time" title="Automatically attach wall clock time" class="md-nav__link">
    Automatically attach wall clock time
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-pravega-readers-request-watermark-windows" title="How Pravega Readers request watermark windows" class="md-nav__link">
    How Pravega Readers request watermark windows
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preventing-a-stalled-watermark" title="Preventing a stalled watermark" class="md-nav__link">
    Preventing a stalled watermark
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-applications" title="Integration with applications" class="md-nav__link">
    Integration with applications
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/pravega/pravega/tree/master/documentation/src/docs/watermarking.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <!--
Copyright (c) Dell Inc., or its subsidiaries. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0
-->
<h1 id="watermarking">Watermarking<a class="headerlink" href="#watermarking" title="Permanent link">&para;</a></h1>
<p>Stream-processing applications may require a time-bounded set of metrics to make a calculation, make a decision, or
commit a transaction. Pravega watermarking provides a way for applications to define time and know with some certainty
that it has a complete set of data up to a watermark. All events earlier than a watermark can be processed, acted upon,
or committed.</p>
<p>In Pravega stream processing, data ingress is typically handled by multiple Pravega Writers, and data processing is
typically handled by multiple Pravega Readers. In a parallel processing scenario, events can ingress out of order (even
though final order is guaranteed). Out of order ingress and the possibility of delayed Writers make it difficult for
a Reader application to know when a complete set of events exists for any given time window. How long should a Reader
wait before deciding that it has all of the events for a defined time window?  Watermarking satisfies that question.</p>
<p>In general, watermarking works like this:</p>
<ul>
<li>The concept of time is defined by the application.</li>
<li>Pravega Writers report their time and positions in the stream (or use a feature that automatically timestamps events).  </li>
<li>The Pravega controller periodically consolidates the reports into watermarks. The watermark defines both time and a
stream position.</li>
<li>Pravega Readers request time windows and use them to navigate the stream. The lower bound of a returned time window is
the current watermark.</li>
<li>The application can process data with some certainty that the data is complete up to the watermarked time and position.       </li>
</ul>
<h2 id="concepts-related-to-watermarking">Concepts related to watermarking<a class="headerlink" href="#concepts-related-to-watermarking" title="Permanent link">&para;</a></h2>
<h3 id="the-watermark">The watermark<a class="headerlink" href="#the-watermark" title="Permanent link">&para;</a></h3>
<p>The controller produces data structures called watermarks. A watermark has three values:</p>
<ul>
<li><code>lowerTimeBound</code> -  a lower bound time corresponding to the streamcut.  A watermark makes a weak claim that all events in
the stream after the <code>watermark.streamcut</code> have time greater than <code>watermark.lowerbound</code>.</li>
<li><code>upperTimeBound</code> -  an upper bound time corresponding to the streamcut. A watermark makes a weak suggestion that all
events it saw up to <code>watermark.streamcut</code> have an upper bound time of watermark.upperBound.</li>
<li><code>streamcut(position)</code> - an upper bound on positions from all writers with respect to the lower bound time.</li>
</ul>
<p>A streamcut is a logical partition of a stream. It corresponds to a <code>segment to offset</code> mapping in the stream. Since a
stream is partitioned into multiple segments, a stream cut divides the stream such that you can perform bounded
processing before or after that stream cut. Since stream cut spans multiple segments, offsets in each segment correspond
to individual events written within those segments.</p>
<h3 id="time-window">Time window<a class="headerlink" href="#time-window" title="Permanent link">&para;</a></h3>
<p>A Reader requests a time window. A Time window contains two watermarks.</p>
<ul>
<li><code>lowerTimeBound</code></li>
<li><code>upperTimeBound</code></li>
</ul>
<p>In the following example, the two watermarks are W1 and W2.</p>
<div class="codehilite"><pre><span></span><span class="n">TimeWindow</span> <span class="n">T1</span> <span class="o">=</span> <span class="o">{</span><span class="n">W1</span><span class="o">.</span><span class="na">lowerbound</span><span class="o">,</span> <span class="n">W2</span><span class="o">.</span><span class="na">upperbound</span><span class="o">}</span>
</pre></div>
<p>Pravega makes a weak claim that all events between <code>W1.streamCut</code> and <code>W2.streamCut</code> have times that fall in the
timewindow <code>T1</code>.</p>
<h3 id="time">Time<a class="headerlink" href="#time" title="Permanent link">&para;</a></h3>
<p>The concept of time is defined by the application. The Pravega APIs provide the means for Writers to note the time and
for Readers to request the watermarked window of time, but the definition of time itself is controlled by the
application.</p>
<p>The time may indicate the time the data was written to the stream (ingestion time). Time may alternatively be equated
to event time (the time the event occurred).  Time can denote wall clock time, some other traditional time, or an
arbitrary value, like a file number that advances as the application ingests file data.</p>
<p>Time has two requirements:</p>
<ul>
<li>Time is a variable of type <code>long</code>.  </li>
<li>Time must increase monotonically. That is, if time is 6, then a time of 5 is earlier, and a time of 7
is later.</li>
</ul>
<h2 id="how-pravega-writers-report-time">How Pravega Writers report time<a class="headerlink" href="#how-pravega-writers-report-time" title="Permanent link">&para;</a></h2>
<p>A Writer reports time corresponding to a position. A position identifies the location within a stream where the Writer
last wrote something.</p>
<p>There are three ways for Pravega Writers to report time.
* Explicitly note the time<br />
* Note time on transaction commit
* Automatically note wall clock time</p>
<h3 id="explicitly-note-time">Explicitly note time<a class="headerlink" href="#explicitly-note-time" title="Permanent link">&para;</a></h3>
<p>The following API method notes time. The position is captured with time.</p>
<div class="codehilite"><pre><span></span><span class="n">writer</span><span class="o">.</span><span class="na">noteTime</span><span class="o">(</span><span class="kt">long</span> <span class="n">timestamp</span><span class="o">);</span>  
</pre></div>
<p>A Writer can note time after every event write, after writing <code>n</code> number of events, or use it periodically to indicate
the time and position.</p>
<p>Here is example usage:</p>
<div class="codehilite"><pre><span></span><span class="n">EventStreamWriter</span><span class="o">&lt;</span><span class="n">EventType</span><span class="o">&gt;</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">clientFactory</span><span class="o">.</span><span class="na">createEventWriter</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">serializer</span><span class="o">,</span><span class="n">EventWriterConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">build</span><span class="o">());</span>

      <span class="c1">//... write events ...</span>

<span class="n">writer</span><span class="o">.</span><span class="na">noteTime</span><span class="o">(</span><span class="n">currentTime</span><span class="o">);</span>
</pre></div>
<h3 id="note-time-on-transaction-commit">Note time on transaction commit<a class="headerlink" href="#note-time-on-transaction-commit" title="Permanent link">&para;</a></h3>
<p>For transactional writes, the commit call can supply the timestamp. The following Writer method passes the time to the
Controller as part of the commit.</p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">commit</span><span class="o">(</span><span class="kt">long</span> <span class="n">timestamp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">TxnFailedException</span><span class="o">;</span>

<span class="n">Transaction</span><span class="o">&lt;</span><span class="n">EventType</span><span class="o">&gt;</span> <span class="n">txn</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="na">beginTxn</span><span class="o">();</span>

        <span class="c1">//... write events to transaction.</span>

<span class="n">txn</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">txnTimestamp</span><span class="o">);</span>
</pre></div>
<p>During processing, all transaction segments are merged into parent segments. This can happen for a batch of
transactions. As they are merged, the merge offsets are recorded by the controller and composed into a position object
for where the transaction write completed. Within a committed batch of transactions, writer-specific times are calculated
and reported. The watermarking workflow uses these reported times and positions in its next periodic cycle to compute
the watermark bounds.</p>
<h3 id="automatically-attach-wall-clock-time">Automatically attach wall clock time<a class="headerlink" href="#automatically-attach-wall-clock-time" title="Permanent link">&para;</a></h3>
<p>You can set the <code>automaticallyNoteTime</code> option to true when a Writer is created. This option configures the Writer to
automatically attach a system time notation to every event. The option essentially attaches the ingest time to each
event. With this option turned on, no other calls to note the time are required.</p>
<p>Here is an example that configures automatic timestamps on events:</p>
<div class="codehilite"><pre><span></span><span class="n">EventStreamWriter</span><span class="o">&lt;</span><span class="n">EventType</span><span class="o">&gt;</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">clientFactory</span><span class="o">.</span><span class="na">createEventWriter</span><span class="o">(</span><span class="n">stream</span><span class="o">,</span> <span class="n">serializer</span><span class="o">,</span>
        <span class="n">EventWriterConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">automaticallyNoteTime</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>
</pre></div>
<h2 id="how-pravega-readers-request-watermark-windows">How Pravega Readers request watermark windows<a class="headerlink" href="#how-pravega-readers-request-watermark-windows" title="Permanent link">&para;</a></h2>
<p>Multiple Pravega Readers working in parallel each have different current locations in the stream. The Controller
coordinates the Reader positions and can return a window that indicates where in the stream all of the readers are.</p>
<p>The following Reader API method requests the current watermark window.</p>
<p><code>TimeWindow window = reader.getTimeWindow();</code></p>
<p>The <code>TimeWindow</code> is returned as:</p>
<div class="codehilite"><pre><span></span>  public class TimeWindow {
      private final long lowerTimeBound;
      private final long upperTimeBound;
  }
</pre></div>
<p>where:
* <code>lowerTimeBound</code> of the  window is the watermark. The Controller asserts that all readers are done reading all events
earlier than the watermark.
*  <code>upperTimeBound</code> is an arbitrary assignment that can help applications keep track of a moving window of time.</p>
<p>The lower bound is most important as it corresponds to the low watermark. It takes into account the position of all
of the readers and represents the time before which all events have been read, under the assumption that ingestion
respected this order. Events of course can arrive out of order, in which case the low watermark becomes only a strong
indication that all the events with a lower timestamp have been read. When using this time window for window
aggregation, there is a point in which any given window needs to be declared closed, so that processing can occur. For
example, say that we want to count occurrences every hour. When the lower time bound advances to the hour, the
application may choose to immediately close the window and perform the count or wait longer. The choice is up to the
application.</p>
<p>If a reader asks for a time window from a stream whose writers are not generating time stamps, then `null is returned.</p>
<p>The TimeWindow reflects the current position in the stream. It can be called following every <code>readNextEvent()</code> call if
desired, or just periodically to provide support for grouping events into windows.</p>
<h2 id="preventing-a-stalled-watermark">Preventing a stalled watermark<a class="headerlink" href="#preventing-a-stalled-watermark" title="Permanent link">&para;</a></h2>
<p>If a Pravega Writer goes down or is delayed and stops writing events, the Readers wait for possible delayed events from
that Writer. As a result, watermarks stop advancing.  While it is desirable for Readers to wait for delayed events, at
some point it makes sense to stop waiting. For example, perhaps the Writer is offline and is not coming back. The
controller must be allowed to emit a best attempt watermark so processing can continue.</p>
<p>To prevent Readers from waiting indefinitely for a Writer, you can configure the <code>timestampAggregationTimeout</code> parameter
on a stream. This parameter configures the amount of time after which a Writer that has not been heard from will be
excluded from the time window calculation.  Set this parameter on a stream when the stream is defined.</p>
<h2 id="integration-with-applications">Integration with applications<a class="headerlink" href="#integration-with-applications" title="Permanent link">&para;</a></h2>
<p>Typically, an application running a Pravega reader interested in processing with time obtains the low watermark from
the time window. The application then needs downstream operators to process the watermark. For example, Apache Flink
is a stream processing engine that can propagate watermarks very well. We have a Pravega Flink connector that can get
a watermark from the Pravega Reader with the <code>AssignerWithTimeWindows</code> interface, which integrates the Pravega watermark
feature with the periodic watermark in Apache Flink. All Flink applications using Pravega can gain the benefits of event
time or ingest time watermarking using all the standard Apache Flink APIs.</p>
<p>Watermarking support in Pravega is useful in general in event time windowing applications. The following example
application gets a Pravega watermark and uses Apache Flink to process it. It reads data from Pravega and calculates an
average in every event-time 10 minutes. The watermark is important to provide the signal in real time to start and close
every 10-minute window.  The example is <a href="https://github.com/pravega/pravega-samples/blob/master/flink-connector-examples/src/main/java/io/pravega/example/flink/watermark/EventTimeAverage.java">here</a>.
A more in-depth description of the the example is <a href="https://github.com/pravega/pravega-samples/blob/master/flink-connector-examples/doc/watermark/README.md">here</a>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../reader-group-design/" title="Reader Groups" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Reader Groups
              </span>
            </div>
          </a>
        
        
          <a href="../javadoc/" title="Java API Reference" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Java API Reference
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-1508605-1","pravega.io"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>